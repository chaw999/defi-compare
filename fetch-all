#!/bin/bash

echo "ğŸ“Š æ­£åœ¨æ£€æŸ¥ç¯å¢ƒ..."

# Check Node
if command -v node &> /dev/null; then
  echo "Node ç‰ˆæœ¬: $(node -v)"
else
  echo "âŒ Node æœªå®‰è£…"
  exit 1
fi

# Check node_modules
if [ -d "node_modules" ]; then
  echo "âœ… node_modules å·²æ£€æµ‹åˆ°"
else
  echo "âŒ æœªæ£€æµ‹åˆ° node_modules ç›®å½•ã€‚è¯·å…ˆè¿è¡Œ npm install æˆ– yarn install å®‰è£…ä¾èµ–ã€‚"
  exit 1
fi

echo "----------------------------------------"
echo "ğŸš€ ç¬¬ä¸€é˜¶æ®µ: è·å– DeBank æ•°æ®..."
echo "----------------------------------------"
node scripts/fetch_protocol.js
if [ $? -ne 0 ]; then
    echo "âŒ DeBank è„šæœ¬æ‰§è¡Œå¤±è´¥"
    exit 1
fi

echo ""
echo "----------------------------------------"
echo "ğŸš€ ç¬¬äºŒé˜¶æ®µ: è·å– Zerion æ•°æ®..."
echo "----------------------------------------"
node scripts/fetch_zerion.js
if [ $? -ne 0 ]; then
    echo "âŒ Zerion è„šæœ¬æ‰§è¡Œå¤±è´¥"
    exit 1
fi

echo ""
echo "----------------------------------------"
echo "ğŸš€ ç¬¬ä¸‰é˜¶æ®µ: ç”Ÿæˆå¯¹æ¯”æ•°æ® (comparison_data.json)..."
echo "----------------------------------------"
node scripts/generate_comparison.js
if [ $? -ne 0 ]; then
    echo "âŒ å¯¹æ¯”æ•°æ®ç”Ÿæˆå¤±è´¥"
    exit 1
fi

echo ""
echo "âœ¨ å…¨éƒ¨ä»»åŠ¡å®Œæˆï¼æ•°æ®å·²å‡†å¤‡å°±ç»ªã€‚"
echo "   - DeBank æ•°æ®: data/"
echo "   - Zerion æ•°æ®: data_zerion/"
echo "   - å¯¹æ¯”æ–‡ä»¶: comparison_data.json"
echo ""
echo "ğŸ’¡ æç¤º: è¿è¡Œ 'python3 -m http.server 8000' å¹¶è®¿é—® http://localhost:8000/dashboard/ æŸ¥çœ‹ç½‘é¡µã€‚"

